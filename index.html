<!DOCTYPE html>
<html lang="eu">
<head>
  <meta charset="UTF-8" />
  <title>Posizioak euskaraz (A1)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }

    .game {
      background: #020617;
      border-radius: 16px;
      padding: 16px 14px 18px;
      max-width: 520px;
      width: 100%;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-sizing: border-box;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 1.25rem;
      text-align: center;
    }

    .subtitle {
      margin: 0 0 12px;
      font-size: 0.85rem;
      text-align: center;
      color: #9ca3af;
    }

    .clue {
      background: rgba(15, 118, 110, 0.2);
      border: 1px solid rgba(45, 212, 191, 0.4);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 0.85rem;
      text-align: center;
      margin-bottom: 12px;
    }

    .clue span {
      font-weight: 600;
      color: #a5b4fc;
    }

    .board-wrapper {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .board {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      max-width: 420px;
      margin: 0 auto;
      background: radial-gradient(160% 160% at 20% 10%, rgba(79,70,229,.4), rgba(15,23,42,1)),
                  radial-gradient(circle at 80% 80%, rgba(14,165,233,.25), rgba(2,6,23,.6));
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
      overflow: hidden;
      transform: perspective(680px) rotateX(14deg);
      transform-style: preserve-3d;
    }

    .shadow {
      position: absolute;
      inset: 10% 8% 16% 8%;
      background: radial-gradient(ellipse at center, rgba(15, 23, 42, 0.85), rgba(2,6,23,0.2));
      filter: blur(16px);
      transform: translateZ(-40px);
    }

    .reference {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 110px;
      height: 110px;
      transform: translate(-50%, -50%) rotateX(4deg);
      background: linear-gradient(145deg, rgba(226,232,240,0.08), rgba(51,65,85,0.9));
      border-radius: 18px;
      border: 1px solid rgba(249, 250, 251, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      letter-spacing: 0.02em;
      font-size: 0.95rem;
      text-align: center;
      color: #e5e7eb;
      box-shadow: 0 12px 24px rgba(0,0,0,0.35);
      transform-style: preserve-3d;
    }

    .board.double-box::after {
      content: "KUTXA";
      position: absolute;
      top: 50%;
      right: 12%;
      transform: translate(50%, -50%) rotateX(6deg);
      padding: 8px 10px;
      font-size: 0.8rem;
      color: #cbd5e1;
      border-radius: 12px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.5);
      box-shadow: 0 12px 20px rgba(0,0,0,0.25);
    }

    .reference span {
      display: block;
      font-size: 0.7rem;
      font-weight: 400;
      color: #cbd5e1;
      margin-top: 2px;
    }

    #drop-zones {
      position: absolute;
      inset: 0;
    }

    .drop-zone {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      display: grid;
      place-items: center;
      color: #cbd5e1;
      font-size: 0.7rem;
      text-transform: uppercase;
      pointer-events: none;
      box-shadow: inset 0 0 18px rgba(59,130,246,0.12);
      backdrop-filter: blur(4px);
      background: rgba(15,23,42,0.45);
    }

    .drop-zone::after {
      content: '';
      position: absolute;
      inset: 6px;
      border-radius: 50%;
      border: 1px solid rgba(94, 234, 212, 0.28);
      opacity: 0;
      transition: opacity .2s ease;
    }

    .drop-zone.active::after {
      opacity: 1;
    }

    .ball, .companion-ball {
      width: 58px;
      height: 58px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #f9fafb, #22d3ee);
      box-shadow: 0 14px 26px rgba(14, 165, 233, 0.4);
      position: absolute;
      transform: translate(-50%, -50%);
      touch-action: none;
    }

    .ball {
      cursor: grab;
      border: 2px solid rgba(226,232,240,0.9);
      z-index: 2;
      transition: box-shadow .2s ease;
    }

    .ball:active { cursor: grabbing; box-shadow: 0 18px 36px rgba(14, 165, 233, 0.6); }

    .companion-ball {
      background: radial-gradient(circle at 30% 20%, #ede9fe, #a78bfa);
      border: 2px solid rgba(233, 213, 255, 0.85);
      opacity: 0.6;
      z-index: 1;
    }

    .launchpad {
      background: rgba(15, 23, 42, 0.65);
      border: 1px dashed rgba(148, 163, 184, 0.4);
      border-radius: 12px;
      padding: 10px;
      display: grid;
      gap: 6px;
      color: #cbd5e1;
      font-size: 0.85rem;
      position: relative;
    }

    .launchpad .ball {
      position: relative;
      transform: none;
      left: unset;
      top: unset;
    }

    .feedback {
      margin-top: 10px;
      min-height: 20px;
      font-size: 0.9rem;
      text-align: center;
    }

    .feedback.ok { color: #4ade80; }
    .feedback.error { color: #f87171; }

    .controls {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: .85rem;
      cursor: pointer;
      background: linear-gradient(90deg,#6366f1,#14b8a6);
      color: white;
    }

    button.secondary {
      background: transparent;
      border: 1px solid rgba(148,163,184,.7);
    }
  </style>
</head>
<body>
<main class="game">

  <h1>Posizioak euskaraz (A1)</h1>
  <p class="subtitle">Arrastatu pilota esaldian deskribatutako posiziora.</p>

  <div class="clue">
    Esaldia: <span id="clue-text"></span>
  </div>

  <div class="board-wrapper">
    <div id="board" class="board">
      <div class="reference" aria-hidden="true">
        KUTXA
        <span>(erreferentzia)</span>
      </div>
      <div id="drop-zones" aria-hidden="true"></div>
      <div class="shadow" aria-hidden="true"></div>
      <div id="companion-ball" class="companion-ball" aria-hidden="true"></div>
    </div>
    <div class="launchpad">
      <p>Arrastatu pilota kokalekuan jartzeko. Bigarren pilota morea automatikoki kokatuko da, kutxa bien artean geratzeko.</p>
      <div id="draggable" class="ball" role="button" aria-label="Arrastatu pilota"></div>
    </div>
  </div>

  <div id="feedback" class="feedback" aria-live="polite"></div>

  <div class="controls">
    <button id="next-btn">Hurrengoa</button>
    <button id="show-solution-btn" class="secondary">Erakutsi soluzioa</button>
  </div>

</main>

<script>

const POSITIONS = [
  { id:"gainean",   label:"Gainean",   clue:"Kutxaren gainean dago." },
  { id:"azpian",    label:"Azpian",    clue:"Kutxaren azpian dago." },
  { id:"aurrean",   label:"Aurrealdean",   clue:"Kutxaren aurrean dago." },
  { id:"atzean",    label:"Atzean",    clue:"Kutxaren atzean dago." },
  { id:"eskuinean", label:"Eskuinean", clue:"Kutxaren eskuinean dago." },
  { id:"ezkerrean", label:"Ezkerrean", clue:"Kutxaren ezkerrean dago." },
  { id:"ondoan",    label:"Ondoan",    clue:"Kutxaren ondoan dago." },
  { id:"artean",    label:"Artean",    clue:"Bi punturen artean, kutxaren eskuin aldean." },
  { id:"erdian",    label:"Erdian",    clue:"Bi pilotaren artean erdian dago." },
  { id:"barruan",   label:"Barruan",   clue:"Kutxaren barruan dago." },
  { id:"kanpoan",   label:"Kanpoan",   clue:"Kutxaren kanpoan dago." },
  { id:"inguruan",  label:"Inguruan",  clue:"Kutxaren inguruan biraka." },
];

const POSITION_COORDS = {
  gainean:    { x: 50, y: 18 },
  aurrean:    { x: 50, y: 30 },
  atzean:     { x: 50, y: 70 },
  azpian:     { x: 50, y: 82 },
  eskuinean:  { x: 77, y: 52 },
  ezkerrean:  { x: 23, y: 52 },
  ondoan:     { x: 68, y: 60 },
  artean:     { x: 70, y: 52 },
  erdian:     { x: 50, y: 44 },
  barruan:    { x: 50, y: 56 },
  kanpoan:    { x: 15, y: 15 },
  inguruan:   { x: 50, y: 10 },
};

const clueSpan = document.getElementById("clue-text");
const feedback = document.getElementById("feedback");
const board = document.getElementById("board");
const dropZones = document.getElementById("drop-zones");
const launchpad = document.querySelector(".launchpad");
const ball = document.getElementById("draggable");
const companionBall = document.getElementById("companion-ball");

let zones = [];
let currentTarget = null;
let locked = false;
let orbitInterval = null;

function randomChoice(arr) {
  return arr[Math.floor(Math.random()*arr.length)];
}

function buildDropZones() {
  dropZones.innerHTML = "";
  zones = POSITIONS.map(pos => {
    const el = document.createElement("div");
    el.className = "drop-zone";
    el.dataset.id = pos.id;
    el.textContent = pos.label;
    dropZones.appendChild(el);
    return { id: pos.id, el, cx: 0, cy: 0 };
  });
  positionDropZones();
}

function positionDropZones() {
  const rect = board.getBoundingClientRect();
  zones.forEach(zone => {
    const coords = POSITION_COORDS[zone.id];
    zone.cx = (coords.x / 100) * rect.width;
    zone.cy = (coords.y / 100) * rect.height;
    zone.el.style.left = coords.x + "%";
    zone.el.style.top = coords.y + "%";
  });
}

function resetBall() {
  locked = false;
  ball.classList.remove("floating");
  ball.style.left = "";
  ball.style.top = "";
  ball.style.transition = "";
  launchpad.appendChild(ball);
  companionBall.style.left = "50%";
  companionBall.style.top = "40%";
}

function showFeedback(message, status = "") {
  feedback.textContent = message;
  feedback.className = "feedback" + (status ? " " + status : "");
}

function setBoardMode(id) {
  board.classList.toggle("double-box", id === "artean");
}

function nearestZone(point) {
  return zones.reduce((best, zone) => {
    const dist = Math.hypot(point.x - zone.cx, point.y - zone.cy);
    if (!best || dist < best.dist) return { zone, dist };
    return best;
  }, null);
}

function snapToZone(zone, animate = true) {
  const rect = board.getBoundingClientRect();
  const x = zone.cx;
  const y = zone.cy;
  ball.style.transition = animate ? "transform .2s ease, left .2s ease, top .2s ease" : "";
  ball.style.left = x + "px";
  ball.style.top = y + "px";
  ball.classList.add("floating");
  board.appendChild(ball);

  // Companion ball mirrored so kutxa geratzen da bien artean
  const mirrorX = rect.width - x;
  const mirrorY = rect.height - y + 30;
  companionBall.style.left = mirrorX + "px";
  companionBall.style.top = mirrorY + "px";
}

function startOrbit() {
  clearInterval(orbitInterval);
  if (currentTarget.id !== "inguruan") return;
  let angle = 0;
  orbitInterval = setInterval(() => {
    angle = (angle + 8) % 360;
    const rect = board.getBoundingClientRect();
    const radius = rect.width * 0.35;
    const center = { x: rect.width / 2, y: rect.height / 2 };
    const rad = angle * Math.PI / 180;
    const point = { x: center.x + Math.cos(rad) * radius, y: center.y + Math.sin(rad) * radius * 0.75 };
    ball.style.left = point.x + "px";
    ball.style.top = point.y + "px";
  }, 80);
}

function stopOrbit() {
  clearInterval(orbitInterval);
}

function newQuestion() {
  stopOrbit();
  zones.forEach(z => z.el.classList.remove("active"));
  showFeedback("");
  currentTarget = randomChoice(POSITIONS);
  clueSpan.textContent = currentTarget.clue;
  setBoardMode(currentTarget.id);
  resetBall();
}

function handleDrop(zone) {
  stopOrbit();
  snapToZone(zone);
  if (locked) return;

  if (zone.id === currentTarget.id) {
    locked = true;
    showFeedback("✔️ Oso ongi!", "ok");
    if (zone.id === "inguruan") startOrbit();
  } else {
    showFeedback("❌ Ez da hori.", "error");
  }
}

function handleDrag() {
  let dragging = false;

  const pointerMove = (evt) => {
    if (!dragging) return;
    const rect = board.getBoundingClientRect();
    const point = { x: evt.clientX - rect.left, y: evt.clientY - rect.top };
    ball.style.left = point.x + "px";
    ball.style.top = point.y + "px";
    ball.classList.add("floating");
    board.appendChild(ball);

    const nearest = nearestZone(point);
    zones.forEach(z => z.el.classList.toggle("active", nearest && z.id === nearest.zone.id));
  };

  const pointerUp = (evt) => {
    if (!dragging) return;
    dragging = false;
    window.removeEventListener("pointermove", pointerMove);
    window.removeEventListener("pointerup", pointerUp);

    const rect = board.getBoundingClientRect();
    const point = { x: evt.clientX - rect.left, y: evt.clientY - rect.top };
    const nearest = nearestZone(point);
    if (nearest) {
      handleDrop(nearest.zone);
    }
  };

  ball.addEventListener("pointerdown", (evt) => {
    evt.preventDefault();
    dragging = true;
    ball.style.transition = "";
    window.addEventListener("pointermove", pointerMove);
    window.addEventListener("pointerup", pointerUp);
  });
}

document.getElementById("next-btn").addEventListener("click", newQuestion);

document.getElementById("show-solution-btn").addEventListener("click", () => {
  const zone = zones.find(z => z.id === currentTarget.id);
  if (zone) {
    handleDrop(zone);
  }
});

window.addEventListener("resize", positionDropZones);

buildDropZones();
handleDrag();
newQuestion();

</script>
</body>
</html>
