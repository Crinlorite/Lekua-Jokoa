<!DOCTYPE html>
<html lang="eu">
<head>
  <meta charset="UTF-8" />
  <title>Posizioak euskaraz (A1)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }

    .game {
      background: #020617;
      border-radius: 16px;
      padding: 16px 14px 18px;
      max-width: 520px;
      width: 100%;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-sizing: border-box;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 1.25rem;
      text-align: center;
    }

    .subtitle {
      margin: 0 0 12px;
      font-size: 0.85rem;
      text-align: center;
      color: #9ca3af;
    }

    .clue {
      background: rgba(15, 118, 110, 0.2);
      border: 1px solid rgba(45, 212, 191, 0.4);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 0.85rem;
      text-align: center;
      margin-bottom: 12px;
    }

    .clue span {
      font-weight: 600;
      color: #a5b4fc;
    }

    .board-wrapper {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .board {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      max-width: 420px;
      margin: 0 auto;
      background: radial-gradient(160% 160% at 20% 10%, rgba(79,70,229,.4), rgba(15,23,42,1)),
                  radial-gradient(circle at 80% 80%, rgba(14,165,233,.25), rgba(2,6,23,.6));
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
      overflow: hidden;
      transform: perspective(680px) rotateX(14deg);
      transform-style: preserve-3d;
    }

    .shadow {
      position: absolute;
      inset: 10% 8% 16% 8%;
      background: radial-gradient(ellipse at center, rgba(15, 23, 42, 0.85), rgba(2,6,23,0.2));
      filter: blur(16px);
      transform: translateZ(-40px);
    }

    .reference {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 110px;
      height: 110px;
      transform: translate(-50%, -50%) rotateX(4deg);
      background: linear-gradient(145deg, rgba(226,232,240,0.08), rgba(51,65,85,0.9));
      border-radius: 18px;
      border: 1px solid rgba(249, 250, 251, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      letter-spacing: 0.02em;
      font-size: 0.95rem;
      text-align: center;
      color: #e5e7eb;
      box-shadow: 0 12px 24px rgba(0,0,0,0.35);
      transform-style: preserve-3d;
    }

    .board.double-box::after {
      content: "KUTXA";
      position: absolute;
      top: 50%;
      right: 12%;
      transform: translate(50%, -50%) rotateX(6deg);
      padding: 8px 10px;
      font-size: 0.8rem;
      color: #cbd5e1;
      border-radius: 12px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.5);
      box-shadow: 0 12px 20px rgba(0,0,0,0.25);
    }

    .reference span {
      display: block;
      font-size: 0.7rem;
      font-weight: 400;
      color: #cbd5e1;
      margin-top: 2px;
    }

    #drop-zones {
      position: absolute;
      inset: 0;
    }

    .drop-zone {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      display: grid;
      place-items: center;
      color: #cbd5e1;
      font-size: 0.7rem;
      text-transform: uppercase;
      pointer-events: none;
      box-shadow: inset 0 0 18px rgba(59,130,246,0.12);
      backdrop-filter: blur(4px);
      background: rgba(15,23,42,0.45);
    }

    .drop-zone::after {
      content: '';
      position: absolute;
      inset: 6px;
      border-radius: 50%;
      border: 1px solid rgba(94, 234, 212, 0.28);
      opacity: 0;
      transition: opacity .2s ease;
    }

    .drop-zone.active::after {
      opacity: 1;
    }

    .ball, .companion-ball {
      width: 58px;
      height: 58px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #f9fafb, #22d3ee);
      box-shadow: 0 14px 26px rgba(14, 165, 233, 0.4);
      position: absolute;
      transform: translate(-50%, -50%);
      touch-action: none;
    }

    .ball {
      cursor: grab;
      border: 2px solid rgba(226,232,240,0.9);
      z-index: 2;
      transition: box-shadow .2s ease;
    }

    .ball:active { cursor: grabbing; box-shadow: 0 18px 36px rgba(14, 165, 233, 0.6); }

    .companion-ball {
      background: radial-gradient(circle at 30% 20%, #ede9fe, #a78bfa);
      border: 2px solid rgba(233, 213, 255, 0.85);
      opacity: 0.6;
      z-index: 1;
    }

    .launchpad {
      background: rgba(15, 23, 42, 0.65);
      border: 1px dashed rgba(148, 163, 184, 0.4);
      border-radius: 12px;
      padding: 10px;
      display: grid;
      gap: 6px;
      color: #cbd5e1;
      font-size: 0.85rem;
      position: relative;
    }

    .chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      padding: 6px 10px;
      background: rgba(148,163,184,.15);
      color: #e5e7eb;
      cursor: pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }

    .chip:hover { transform: translateY(-1px); border-color: #22d3ee; }
    .chip:active { transform: translateY(0); }
    .chip.selected { background: rgba(52,211,153,.16); border-color: #34d399; }
    .chip.correct { background: rgba(74,222,128,.2); border-color: #4ade80; }
    .chip.locked { opacity: 0.6; cursor: not-allowed; }

    .attempts { font-size: 0.8rem; color: #9ca3af; }

    .launchpad .ball {
      position: relative;
      transform: none;
      left: unset;
      top: unset;
    }

    .feedback {
      margin-top: 10px;
      min-height: 20px;
      font-size: 0.9rem;
      text-align: center;
    }

    .feedback.ok { color: #4ade80; }
    .feedback.error { color: #f87171; }

    .controls {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: .85rem;
      cursor: pointer;
      background: linear-gradient(90deg,#6366f1,#14b8a6);
      color: white;
    }

    button.secondary {
      background: transparent;
      border: 1px solid rgba(148,163,184,.7);
    }
  </style>
</head>
<body>
<main class="game">

  <h1>Posizioak euskaraz (A1)</h1>
  <p class="subtitle">Aukeratu txip batekin non dagoen pilota edo kutxa, ikusitako egoeran.</p>

  <div class="clue">
    Esaldia: <span id="clue-text"></span>
  </div>

  <div class="board-wrapper">
    <div id="board" class="board">
      <div class="reference" aria-hidden="true">
        KUTXA
        <span>(erreferentzia)</span>
      </div>
      <div id="drop-zones" aria-hidden="true"></div>
      <div class="shadow" aria-hidden="true"></div>
      <div id="companion-ball" class="companion-ball" aria-hidden="true"></div>
      <div id="draggable" class="ball" aria-hidden="true"></div>
    </div>
    <div class="launchpad">
      <p>Begira eszenari: non dago elementua galderak dioen bezala? Hautatu erantzuna txip batekin. Posizio oso antzekoak daude, beraz 3 saiakera dituzu.</p>
      <div id="question-text"></div>
      <div id="chips" class="chip-group" role="listbox" aria-label="Erantzun posibleak"></div>
      <div class="attempts" id="attempts"></div>
    </div>
  </div>

  <div id="feedback" class="feedback" aria-live="polite"></div>

  <div class="controls">
    <button id="next-btn">Hurrengoa</button>
    <button id="show-solution-btn" class="secondary">Erakutsi soluzioa</button>
  </div>

</main>

<script>

const POSITIONS = [
  { id:"gainean",   label:"Gainean",   clue:"Kutxaren gainean dago." },
  { id:"azpian",    label:"Azpian",    clue:"Kutxaren azpian dago." },
  { id:"aurrean",   label:"Aurrealdean",   clue:"Kutxaren aurrean dago." },
  { id:"atzean",    label:"Atzean",    clue:"Kutxaren atzean dago." },
  { id:"eskuinean", label:"Eskuinean", clue:"Kutxaren eskuinean dago." },
  { id:"ezkerrean", label:"Ezkerrean", clue:"Kutxaren ezkerrean dago." },
  { id:"ondoan",    label:"Ondoan",    clue:"Kutxaren ondoan dago." },
  { id:"artean",    label:"Artean",    clue:"Bi punturen artean, kutxaren eskuin aldean." },
  { id:"erdian",    label:"Erdian",    clue:"Bi pilotaren artean erdian dago." },
  { id:"barruan",   label:"Barruan",   clue:"Kutxaren barruan dago." },
  { id:"kanpoan",   label:"Kanpoan",   clue:"Kutxaren kanpoan dago." },
  { id:"inguruan",  label:"Inguruan",  clue:"Kutxaren inguruan biraka." },
];

const POSITION_COORDS = {
  gainean:    { x: 50, y: 18 },
  aurrean:    { x: 50, y: 30 },
  atzean:     { x: 50, y: 70 },
  azpian:     { x: 50, y: 82 },
  eskuinean:  { x: 77, y: 52 },
  ezkerrean:  { x: 23, y: 52 },
  ondoan:     { x: 68, y: 60 },
  artean:     { x: 70, y: 52 },
  erdian:     { x: 50, y: 44 },
  barruan:    { x: 50, y: 56 },
  kanpoan:    { x: 15, y: 15 },
  inguruan:   { x: 50, y: 10 },
};

const INVERSE_POSITION = {
  gainean: "azpian",
  azpian: "gainean",
  aurrean: "atzean",
  atzean: "aurrean",
  eskuinean: "ezkerrean",
  ezkerrean: "eskuinean",
  ondoan: "ondoan",
};

const QUESTION_BUILDERS = [
  {
    id: "ball",
    prompt: "Non dago pilota kutxarekiko?",
    isValid: () => true,
    getAnswer: (pos) => pos.id,
  },
  {
    id: "box",
    prompt: "Non dago kutxa pilotarekiko?",
    isValid: (pos) => Boolean(INVERSE_POSITION[pos.id]),
    getAnswer: (pos) => INVERSE_POSITION[pos.id],
  }
];

const MAX_ATTEMPTS = 3;

const clueSpan = document.getElementById("clue-text");
const questionText = document.getElementById("question-text");
const chipsContainer = document.getElementById("chips");
const attemptsEl = document.getElementById("attempts");
const feedback = document.getElementById("feedback");
const board = document.getElementById("board");
const ball = document.getElementById("draggable");
const companionBall = document.getElementById("companion-ball");

let locked = false;
let orbitInterval = null;
let attemptsLeft = MAX_ATTEMPTS;
let currentSituation = null;

function randomChoice(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function showFeedback(message, status = "") {
  feedback.textContent = message;
  feedback.className = "feedback" + (status ? " " + status : "");
}

function setBoardMode(id) {
  board.classList.toggle("double-box", id === "artean");
}

function placeBall(positionId) {
  const coords = POSITION_COORDS[positionId];
  ball.style.left = coords.x + "%";
  ball.style.top = coords.y + "%";

  companionBall.style.left = (100 - coords.x) + "%";
  companionBall.style.top = (100 - coords.y + 6) + "%";

  stopOrbit();
  if (positionId === "inguruan") {
    startOrbit();
  }
}

function startOrbit() {
  clearInterval(orbitInterval);
  let angle = 0;
  orbitInterval = setInterval(() => {
    angle = (angle + 8) % 360;
    const rect = board.getBoundingClientRect();
    const radius = rect.width * 0.35;
    const center = { x: rect.width / 2, y: rect.height / 2 };
    const rad = angle * Math.PI / 180;
    const point = { x: center.x + Math.cos(rad) * radius, y: center.y + Math.sin(rad) * radius * 0.75 };
    ball.style.left = point.x + "px";
    ball.style.top = point.y + "px";
  }, 80);
}

function stopOrbit() {
  clearInterval(orbitInterval);
}

function renderChips() {
  chipsContainer.innerHTML = "";
  POSITIONS.forEach(pos => {
    const chip = document.createElement("button");
    chip.type = "button";
    chip.className = "chip";
    chip.dataset.id = pos.id;
    chip.textContent = pos.label;
    chip.addEventListener("click", () => handleAnswer(pos.id));
    chipsContainer.appendChild(chip);
  });
}

function resetChips() {
  chipsContainer.querySelectorAll(".chip").forEach(chip => {
    chip.classList.remove("selected", "correct", "locked");
    chip.disabled = false;
  });
}

function setLockedChips() {
  chipsContainer.querySelectorAll(".chip").forEach(chip => {
    chip.classList.add("locked");
    chip.disabled = true;
  });
}

function updateAttempts() {
  attemptsEl.textContent = `Saiakerak: ${attemptsLeft}/${MAX_ATTEMPTS}`;
}

function revealSolution() {
  if (!currentSituation) return;
  const correctChip = chipsContainer.querySelector(`[data-id="${currentSituation.correctId}"]`);
  if (correctChip) {
    correctChip.classList.add("correct");
  }
  showFeedback("ðŸ” Hona erantzun zuzena.");
  locked = true;
  setLockedChips();
}

function newQuestion() {
  locked = false;
  attemptsLeft = MAX_ATTEMPTS;
  updateAttempts();
  showFeedback("");

  let position = randomChoice(POSITIONS);
  let builder = randomChoice(QUESTION_BUILDERS.filter(q => q.isValid(position)));

  // Baliteke lehen aukerak ez edukitzea alderantzizko galderarik; ziurtatu baliozkoa dela.
  while (!builder) {
    position = randomChoice(POSITIONS);
    builder = randomChoice(QUESTION_BUILDERS.filter(q => q.isValid(position)));
  }

  currentSituation = {
    position,
    question: builder.prompt,
    correctId: builder.getAnswer(position)
  };

  clueSpan.textContent = position.clue;
  questionText.textContent = builder.prompt;
  setBoardMode(position.id);
  resetChips();
  placeBall(position.id);
}

function handleAnswer(selectedId) {
  if (locked || !currentSituation) return;

  const chip = chipsContainer.querySelector(`[data-id="${selectedId}"]`);
  if (chip) chip.classList.add("selected");

  if (selectedId === currentSituation.correctId) {
    locked = true;
    showFeedback("âœ”ï¸ Oso ongi!", "ok");
    const correctChip = chipsContainer.querySelector(`[data-id="${currentSituation.correctId}"]`);
    if (correctChip) correctChip.classList.add("correct");
    setLockedChips();
  } else {
    attemptsLeft -= 1;
    if (attemptsLeft > 0) {
      showFeedback(`âŒ Ez da hori. Beste saiakera ${attemptsLeft} ðŸ”`, "error");
      updateAttempts();
    } else {
      updateAttempts();
      revealSolution();
    }
  }
}

document.getElementById("next-btn").addEventListener("click", newQuestion);

document.getElementById("show-solution-btn").addEventListener("click", () => {
  if (!locked) {
    revealSolution();
  }
});

window.addEventListener("resize", () => {
  if (currentSituation) {
    placeBall(currentSituation.position.id);
  }
});

renderChips();
newQuestion();

</script>
</body>
</html>
